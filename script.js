import*as t from"three";import{GLTFLoader as e}from"https://rawcdn.githack.com/mrdoob/three.js/master/examples/jsm/loaders/GLTFLoader.js";let flightModel="",flightList=[],scene=new t.Scene;scene.background=new t.CubeTextureLoader().setPath("texture/cubemap/").load(["right.jpeg","left.jpeg","top.jpeg","bottom.jpeg","front.jpeg","back.jpeg"]);let light=new t.HemisphereLight(16777147,526368,1);scene.add(light);let camera=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,1e4),geometry=new t.CylinderGeometry(.19,.19,128,64),material=new t.MeshBasicMaterial({color:16777215}),canvas=document.getElementById("map"),ctx=canvas.getContext("2d");function animate(){requestAnimationFrame(animate);for(let t=0;t<6;t++){let e=scene.getObjectByName(flightList[t].name);"<"===flightList[t].rotate?(e.rotation.z-=Math.PI/36,e.rotation.z<=-Math.PI/2.6&&(e.rotation.z=-Math.PI/2.6),e.rotation.y+=Math.PI/270):">"===flightList[t].rotate?(e.rotation.z+=Math.PI/36,e.rotation.z>=Math.PI/2.6&&(e.rotation.z=Math.PI/2.6),e.rotation.y-=Math.PI/270):Math.abs(e.rotation.z)<Math.PI/36?e.rotation.z=0:e.rotation.z>0?e.rotation.z-=Math.PI/36:e.rotation.z<0&&(e.rotation.z+=Math.PI/36);let i=-e.rotation.y*(180/Math.PI)%360;i=i<0?360+i:i,e.position.z>=5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=0&&i<=90?flightList[t].rotate=">":flightList[t].rotate="<"):e.position.z<=-5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=180&&i<=270?flightList[t].rotate=">":flightList[t].rotate="<"):e.position.x>=5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=270&&i<=360?flightList[t].rotate=">":flightList[t].rotate="<"):e.position.x<=-5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=90&&i<=180?flightList[t].rotate=">":flightList[t].rotate="<"):!0==flightList[t].autopilot&&(flightList[t].rotate="|",flightList[t].autopilot=!1),e.translateZ(5),0==t&&(camera.position.set(e.position.x,e.position.y,e.position.z),camera.rotation.y=e.rotation.y+Math.PI,camera.translateZ(24),camera.translateY(3.9));for(let o=0;o<flightList[t].dt.length;o++)if(0==flightList[t].dt[o].moveCount){let a=scene.getObjectByName("cylinder").clone();a.position.set(e.position.x,e.position.y,e.position.z),a.rotation.x=-Math.PI/2,a.rotation.z=e.rotation.y+[.005,0,-.005][Math.floor(3*Math.random())],a.name=flightList[t].dt[o].name,a.visible=!0,a.translateY(-75),scene.add(a),flightList[t].dt[o].moveCount+=1}else{flightList[t].dt[o].moveCount+=1;let n=scene.getObjectByName(flightList[t].dt[o].name);n.translateY(-19),flightList[t].dt[o].moveCount>250&&(flightList[t].dt.splice(o,1),scene.remove(n))}}renderer.render(scene,camera)}new e().load("https://rawcdn.githack.com/alperenbutun/free-time-project/master/gltf/f35.glb",function(e){document.querySelector("span#loading").style.display="none",document.addEventListener("mousedown",function(t){switch(t.which){case 1:flightList[0].autopilot||(t.clientX<.5*t.target.clientWidth?flightList[0].rotate="<":flightList[0].rotate=">");break;case 2:break;case 3:flightList[0].dt.push({name:"flight0"+new Date().getTime(),moveCount:0}),flightList[0].dtInterval=setInterval(function(){flightList[0].dt.push({name:"flight0"+new Date().getTime(),moveCount:0})},100)}}),document.addEventListener("mouseup",function(t){switch(t.which){case 1:flightList[0].autopilot||(flightList[0].rotate="|");break;case 2:break;case 3:clearInterval(flightList[0].dtInterval)}}),document.addEventListener("contextmenu",t=>{t.preventDefault()}),setInterval(function(){ctx.clearRect(0,0,250,250);for(let t=0;t<6;t++){let e=scene.getObjectByName(flightList[t].name),i=[Math.floor(e.position.x/40)+125,Math.floor(e.position.z/40)+125];ctx.strokeStyle=0==t?"red":"black",ctx.beginPath(),ctx.arc(i[0],i[1],5,0,2*Math.PI),ctx.stroke()}},500),flightModel=e.scene;for(let i=0;i<6;i++){flightList[flightList.length]={name:"flight"+i,rotate:"|",autopilot:!1,dt:[],dtInterval:"",hit:0,gothit:0};let o=flightModel.clone();o.name="flight"+i,o.position.set(0,0,0),o.rotation.y=Math.random()*Math.PI*2,scene.add(o)}var a=new t.Mesh(geometry,material);a.name="cylinder",a.visible=!1,scene.add(a),animate()},function(t){let e=Math.ceil(t.loaded/t.total*100);document.querySelector("span#percentage").innerHTML=" "+e+"% loaded ("+Math.ceil(32*e/100)+"MB of 32MB)"});let renderer=new t.WebGLRenderer;renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement);