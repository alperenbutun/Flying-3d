import*as t from"three";import{GLTFLoader as e}from"https://rawcdn.githack.com/mrdoob/three.js/master/examples/jsm/loaders/GLTFLoader.js";let flightModel="",flightList=[],countdown=600,scene=new t.Scene;scene.background=new t.CubeTextureLoader().setPath("texture/cubemap/").load(["right.jpeg","left.jpeg","top.jpeg","bottom.jpeg","front.jpeg","back.jpeg"]);let light=new t.HemisphereLight(16777147,526368,1);scene.add(light);let camera=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,1e4),geometry=new t.CylinderGeometry(.19,.19,128,64),material=new t.MeshBasicMaterial({color:16777215}),canvas=document.getElementById("map"),ctx=canvas.getContext("2d");function printCountDown(){if(Math.floor(countdown)==countdown){let t=Math.floor(countdown/60),e=countdown-60*Math.floor(countdown/60);if(document.querySelector("span#countdown").innerHTML=t+":"+(e<10?"0"+e:e),0==countdown){document.title="game ended";return}}}function bullet(t){flightList[t].dt.push({name:"flight"+t+new Date().getTime(),moveCount:0}),flightList[t].bullet++,document.querySelector("#bullet-text").innerHTML=flightList[t].bullet}function animate(){requestAnimationFrame(animate);for(let t=0;t<flightList.length;t++){let e=scene.getObjectByName(flightList[t].name);"<"===flightList[t].rotate?(e.rotation.z-=Math.PI/36,e.rotation.z<=-Math.PI/2.6&&(e.rotation.z=-Math.PI/2.6),e.rotation.y+=Math.PI/270):">"===flightList[t].rotate?(e.rotation.z+=Math.PI/36,e.rotation.z>=Math.PI/2.6&&(e.rotation.z=Math.PI/2.6),e.rotation.y-=Math.PI/270):Math.abs(e.rotation.z)<Math.PI/36?e.rotation.z=0:e.rotation.z>0?e.rotation.z-=Math.PI/36:e.rotation.z<0&&(e.rotation.z+=Math.PI/36);let i=-e.rotation.y*(180/Math.PI)%360;i=i<0?360+i:i,e.position.z>=5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=0&&i<=90?flightList[t].rotate=">":flightList[t].rotate="<"):e.position.z<=-5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=180&&i<=270?flightList[t].rotate=">":flightList[t].rotate="<"):e.position.x>=5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=270&&i<=360?flightList[t].rotate=">":flightList[t].rotate="<"):e.position.x<=-5e3?!1==flightList[t].autopilot&&(flightList[t].autopilot=!0,i>=90&&i<=180?flightList[t].rotate=">":flightList[t].rotate="<"):!0==flightList[t].autopilot&&(flightList[t].rotate="|",flightList[t].autopilot=!1),e.translateZ(5),0==t&&(camera.position.set(e.position.x,e.position.y,e.position.z),camera.rotation.y=e.rotation.y+Math.PI,camera.translateZ(24),camera.translateY(3.9));for(let o=0;o<flightList[t].dt.length;o++)if(0==flightList[t].dt[o].moveCount){let n=scene.getObjectByName("cylinder").clone();n.position.set(e.position.x,e.position.y,e.position.z),n.rotation.x=-Math.PI/2,n.rotation.z=e.rotation.y+[.0075,.005,.0025,-.0025,-.005,-.0075][Math.floor(6*Math.random())],n.name=flightList[t].dt[o].name,n.visible=!0,n.translateY(-75),scene.add(n),flightList[t].dt[o].moveCount+=1}else{flightList[t].dt[o].moveCount+=1;let l=scene.getObjectByName(flightList[t].dt[o].name);if(l.translateY(-19),flightList[t].dt[o].moveCount>250)flightList[t].dt.splice(o,1),scene.remove(l);else for(let a=0;a<flightList.length;a++){if(t==a)continue;let r=scene.getObjectByName(flightList[a].name);7>Math.sqrt(Math.pow(r.position.x-l.position.x,2)+Math.pow(r.position.z-l.position.z,2))&&(flightList[t].hit+=1,flightList[a].gothit+=1,flightList[t].dt.splice(o,1),scene.remove(l))}}}renderer.render(scene,camera)}new e().load("https://rawcdn.githack.com/alperenbutun/free-time-project/master/gltf/f35.glb",function(e){document.addEventListener("mousedown",function(t){switch(t.which){case 1:flightList[0].autopilot||(t.clientX<.5*t.target.clientWidth?flightList[0].rotate="<":flightList[0].rotate=">");break;case 2:break;case 3:bullet(0),flightList[0].dtInterval=setInterval(function(){bullet(0)},123)}}),document.addEventListener("mouseup",function(t){switch(t.which){case 1:flightList[0].autopilot||(flightList[0].rotate="|");break;case 2:break;case 3:clearInterval(flightList[0].dtInterval)}}),document.addEventListener("contextmenu",function(t){t.preventDefault()}),document.addEventListener("keydown",function(t){9===t.keyCode&&(t.preventDefault(),document.querySelector("#table").style.display="block",document.querySelector("#table-head").style.display="block",document.querySelector("div#tab-text").style.display="none")}),document.addEventListener("keyup",function(t){9===t.keyCode&&(t.preventDefault(),document.querySelector("#table").style.display="none",document.querySelector("#table-head").style.display="none",document.querySelector("div#tab-text").style.display="block")}),setInterval(function(){let t=[];ctx.clearRect(0,0,250,250);for(let e=0;e<flightList.length;e++){let i=scene.getObjectByName(flightList[e].name),o=[Math.floor(i.position.x/40)+125,Math.floor(i.position.z/40)+125];ctx.strokeStyle=0==e?"red":"black",ctx.beginPath(),ctx.arc(o[0],o[1],5,0,2*Math.PI),ctx.stroke(),flightList[e].average=flightList[e].hit-flightList[e].gothit,t[t.length]=flightList[e]}t.sort(function(t,e){return e.average-t.average}),document.querySelector("#table").innerHTML="";for(let n=0;n<t.length;n++)document.querySelector("#table").innerHTML+='<div style="position:relative;float:left;width:100%;height:32px;"><span style="position:relative;float:left;left:11px;top:5px;">'+t[n].name+'</span><span style="position:relative;float:right;right:11px;top:5px;">'+t[n].hit+"/"+t[n].gothit+" > "+t[n].average+"</span></div>";countdown>0&&(countdown-=.5,printCountDown())},500),flightModel=e.scene;for(let i=0;i<14;i++){flightList[flightList.length]={name:"flight"+i,rotate:"|",autopilot:!1,dt:[],dtInterval:"",bullet:0,hit:0,gothit:0,average:0};let o=flightModel.clone();o.name="flight"+i,o.position.set(0,0,0),o.rotation.y=Math.random()*Math.PI*2,scene.add(o)}var n=new t.Mesh(geometry,material);n.name="cylinder",n.visible=!1,scene.add(n),document.querySelector("span#loading").style.display="none",document.querySelector("canvas#map").style.display="block",document.querySelector("div#bullet").style.display="block",document.querySelector("div#game").style.display="block",document.querySelector("div#tab-text").style.display="block",animate()},function(t){let e=Math.ceil(t.loaded/t.total*100);document.querySelector("span#percentage").innerHTML=" "+e+"% loaded ("+Math.ceil(32*e/100)+"MB of 32MB)"});let renderer=new t.WebGLRenderer;renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement);